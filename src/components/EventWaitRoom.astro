---
import TwoColumnLayout from "@layouts/TwoColumnLayout.astro"

const { Id, Title, Description, StartAt, EndAt} = Astro.props
import { friendlyDuration, friendlyDateMessage, normalizeDateTime } from "@utils/TimeUtils"
import Timestamp from "@components/Timestamp.astro"
---

	<TwoColumnLayout title="Waiting Room">

	<div slot="max-slot" class="flex flex-col bg-secondary border-2 border-primary rounded-lg h-full p-8 items-center">

		<h1 class="text-3xl">Welcome to the Online quiz !!</h1>
		<h3 class="text-xl text-secondary">You are registered for the following event.</h3>



		<div class="w-full flex flex-col mx-4 mt-8 justify-center">
			<div class=" p-8 bg-tertiary border-2 border-primary rounded-lg">
				<div class="flex flex-row  gap-2">
					<div class="shrink-0 text-primary text-lg  bg-accent flex justify-center items-center rounded-lg w-10 h-10 ">
						<svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
							<path d="M4.5 16.5c-1.5 1.26-2 5-2 5s3.74-.5 5-2c.71-.84.7-2.13-.09-2.91a2.18 2.18 0 0 0-2.91-.09z"/>
							<path d="m12 15-3-3a22 22 0 0 1 2-3.95A12.88 12.88 0 0 1 22 2c0 2.72-.78 7.5-6 11a22.35 22.35 0 0 1-4 2z"/>
							<path d="M9 12H4s.55-3.03 2-4c1.62-1.08 5 0 5 0"/>
							<path d="M12 15v5s3.03-.55 4-2c1.08-1.62 0-5 0-5"/>
						</svg>
					</div>
					
					<div>
						<h1 class="text-3xl">{Title || "Event"}</h1>
						<h3 class="text-xl text-secondary">{Description || "Description"}</h3>

						<div class="flex flex-row items-center mt-4">

							<svg viewBox="0 0 35 35" class="w-6 h-6" xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor">
								<rect x="4" y="6" width="22" height="20" rx="2" stroke-width="2"/>
								<line x1="4" y1="11" x2="26" y2="11" stroke-width="2"/>
								<line x1="9" y1="6" x2="9" y2="3" stroke-width="2" stroke-linecap="round"/>
								<line x1="21" y1="6" x2="21" y2="3" stroke-width="2" stroke-linecap="round"/>
								<text x="15" y="22" text-anchor="middle" font-size="12" font-weight="bold" fill="currentColor" stroke="none">D</text>
							</svg>

							<h3 class="text-lg text-secondary mr-2">Event Duration</h3>
								<h3 class="text-lg font-semibold">{friendlyDuration(normalizeDateTime(StartAt),normalizeDateTime(EndAt))}</h3>
						</div>

						<div class="flex flex-row items-center">

							<svg viewBox="0 0 35 35" class="w-6 h-6" xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor">
								<rect x="4" y="6" width="22" height="20" rx="2" stroke-width="2"/>
								<line x1="4" y1="11" x2="26" y2="11" stroke-width="2"/>
								<line x1="9" y1="6" x2="9" y2="3" stroke-width="2" stroke-linecap="round"/>
								<line x1="21" y1="6" x2="21" y2="3" stroke-width="2" stroke-linecap="round"/>
								<text x="15" y="22" text-anchor="middle" font-size="12" font-weight="bold" fill="currentColor" stroke="none">S</text>
							</svg>

							<h3 class="text-lg text-secondary mr-2">Event Start</h3>
							<h3 class="text-lg font-semibold">{friendlyDateMessage(normalizeDateTime(StartAt))}</h3>

						</div>

						<div class="flex flex-row items-center">

								<svg viewBox="0 0 35 35" class="w-6 h-6" xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor">
									<rect x="4" y="6" width="22" height="20" rx="2" stroke-width="2"/>
									<line x1="4" y1="11" x2="26" y2="11" stroke-width="2"/>
									<line x1="9" y1="6" x2="9" y2="3" stroke-width="2" stroke-linecap="round"/>
									<line x1="21" y1="6" x2="21" y2="3" stroke-width="2" stroke-linecap="round"/>
									<text x="15" y="22" text-anchor="middle" font-size="12" font-weight="bold" fill="currentColor" stroke="none">E</text>
								</svg>

								<h3 class="text-lg text-secondary mr-2">Event End</h3>
								<h3 class="text-lg font-semibold">{friendlyDateMessage(normalizeDateTime(EndAt))}</h3>

						</div>
					</div>

				</div>

			</div>

		</div>


		<div id="countdown" class="text-2xl font-bold border-2 border-primary px-8 py-4 bg-tertiary rounded-lg  flex flex-col items-center mt-8">
			<div class="flex flex-row items-center justify-center">
				<svg xmlns="http://www.w3.org/2000/svg" class="w-10 h-10" viewBox="0 0 128 128" role="img" stroke="currentColor" aria-label="duration icon" class="mt-1 animate-pulse">
					<circle cx="64" cy="52" r="36" fill="none"  stroke-width="8" />
					<line x1="64" y1="52" x2="64" y2="32"  stroke-width="8" stroke-linecap="round"/>
					<line x1="64" y1="52" x2="84" y2="68"  stroke-width="6" stroke-linecap="round"/>
				</svg>
				<Timestamp startTime={StartAt} endTime={EndAt} eventName="Event"/>

			</div>
		</div>

	</div>



	<div slot="min-slot" class="bg-secondary border-2 border-primary rounded-lg h-full p-8 flex flex-col overflow-auto">

		<h1 class="text-3xl">quiz Instructions</h1>
		<h3 class="text-xl text-secondary">Please read carefully before starting</h3>

		<div class="flex flex-col flex-wrap gap-6 mt-8">

			<div class="w-full  border-2 border-primary bg-tertiary rounded-lg p-4">
				<details class="group relative w-full" name="instruction">
					<summary class="list-none cursor-pointer flex items-start justify-between">

						<div class=" flex flex-row gap-2">
							<div class="shrink-0 text-primary text-lg  bg-accent flex justify-center items-center rounded-lg w-10 h-10 ">
								<svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
									<path d="M4.5 16.5c-1.5 1.26-2 5-2 5s3.74-.5 5-2c.71-.84.7-2.13-.09-2.91a2.18 2.18 0 0 0-2.91-.09z"/>
									<path d="m12 15-3-3a22 22 0 0 1 2-3.95A12.88 12.88 0 0 1 22 2c0 2.72-.78 7.5-6 11a22.35 22.35 0 0 1-4 2z"/>
									<path d="M9 12H4s.55-3.03 2-4c1.62-1.08 5 0 5 0"/>
									<path d="M12 15v5s3.03-.55 4-2c1.08-1.62 0-5 0-5"/>
								</svg>
							</div>

							<h1 class="text-xl">Auto Submission</h1>
						</div>

						<svg xmlns="http://www.w3.org/2000/svg"
							class="shrink-0 w-8 h-8 text-primary transition-transform duration-200 group-open:rotate-180 mr-4 mt-0"
							fill="none" viewBox="0 0 24 24" stroke="currentColor">
							<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
								d="M19 9l-7 7-7-7" />
						</svg>
					</summary>

					<p class="text-lg text-secondary mt-2">The quiz will automatically submit when the time limit expires. You cannot extend the time, manage it wisely.</p>
				</details>
			</div>


			<div class="w-full  border-2 border-primary bg-tertiary rounded-lg p-4">
				<details class="group relative w-full" name="instruction">
					<summary class="list-none cursor-pointer flex items-start justify-between">

						<div class=" flex flex-row gap-2">
							<div class="shrink-0 text-primary text-lg  bg-accent flex justify-center items-center rounded-lg w-10 h-10 ">
								1
							</div>

							<h1 class="text-xl">Single Attempt</h1>
						</div>

						<svg xmlns="http://www.w3.org/2000/svg"
							class="shrink-0 w-8 h-8 text-primary transition-transform duration-200 group-open:rotate-180 mr-4 mt-0"
							fill="none" viewBox="0 0 24 24" stroke="currentColor">
							<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
								d="M19 9l-7 7-7-7" />
						</svg>
					</summary>

					<p class="text-lg text-secondary mt-2">Each participant gets only one attempt, Double check all answers before final submission.</p>
				</details>
			</div>


			<div class="w-full  border-2 border-primary bg-tertiary rounded-lg p-4">
				<details class="group relative w-full" name="instruction">
					<summary class="list-none cursor-pointer flex items-start justify-between">

						<div class=" flex flex-row gap-2">
							<div class="shrink-0 text-primary text-lg  bg-accent flex justify-center items-center rounded-lg w-10 h-10 ">
								<svg xmlns="http://www.w3.org/2000/svg" 
									class="shrink-0 w-5 h-5 text-white" 
									fill="none" viewBox="0 0 24 24" stroke="currentColor">
									<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
											d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
									<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
											d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
								</svg>

							</div>

							<h1 class="text-xl">Activity Monitored</h1>
						</div>

						<svg xmlns="http://www.w3.org/2000/svg"
							class="shrink-0 w-8 h-8 text-primary transition-transform duration-200 group-open:rotate-180 mr-4 mt-0"
							fill="none" viewBox="0 0 24 24" stroke="currentColor">
							<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
								d="M19 9l-7 7-7-7" />
						</svg>
					</summary>

					<p class="text-lg text-secondary mt-2">Any outside assistance is strictly prohibited. Your activity is monitored for unfair behavior and may be flagged.</p>
				</details>
			</div>


			<div class="w-full  border-2 border-primary bg-tertiary rounded-lg p-4">
				<details class="group relative w-full" name="instruction">
					<summary class="list-none cursor-pointer flex items-start justify-between">

						<div class=" flex flex-row gap-2">
							<div class="shrink-0 text-white text-lg  bg-accent flex justify-center items-center rounded-lg w-10 h-10 ">
								<svg xmlns="http://www.w3.org/2000/svg" 
									 class="shrink-0 w-5 h-5 text-white" 
									 fill="none" viewBox="0 0 24 24" stroke="currentColor">
									 <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
												 d="M19.938 13c.041-.328.062-.662.062-1 0-4.418-3.582-8-8-8-2.5 0-4.733 1.147-6.2 2.944M4.062 11C4.021 11.328 4 11.661 4 12c0 4.418 3.582 8 8 8 2.389 0 4.534-1.048 6-2.708M15 17h3v.292M5.8 4v2.944m0 0V7l3 .001M18 20v-2.708" />
								</svg>

							</div>

							<h1 class="text-xl">Avoid These Actions</h1>
						</div>


						<svg xmlns="http://www.w3.org/2000/svg"
							class="shrink-0 w-8 h-8 text-primary transition-transform duration-200 group-open:rotate-180 mr-4 mt-0"
							fill="none" viewBox="0 0 24 24" stroke="currentColor">
							<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
								d="M19 9l-7 7-7-7" />
						</svg>
					</summary>

					<p class="text-lg text-secondary mt-2">Do not refresh the page multiple times, switch between tabs, close and reopen browser windows, or leave and rejoin event.</p>
				</details>
			</div>


		</div>
		<div class="flex-1"></div>

		<div class=" bg-tertiary p-6 border-2 border-primary rounded-lg mt-6">
			<h3 class="text-lg text-primary font-bold justify-center items-center w-full inline-flex">Quiz will auto start once timeâ€™s up</h3>
			<div class="flex flex-row mt-4 justify-center items-center">
				<svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 text-accent" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-accent">
					<circle cx="12" cy="12" r="10"/>
					<line x1="12" y1="8" x2="12" y2="12"/>
					<line x1="12" y1="16" x2="12.01" y2="16"/>
				</svg>

					<h3 class="text-lg text-secondary ml-2">Didn't mean to register?</h3>
			</div>

			<div id="unRegister" class="mt-2 " data-unregister={Id}>
				<button class="flex flex-row gap-2 bg-accent text-white hover-overlay active-overlay px-4 py-2 w-full rounded-lg border-2 border-primary items-center justify-center text-lg">
					Cancel Registration
				</button>

			</div>


		</div>

		<script is:inline>
		(function () {
			let refreshScheduled = false;
			function formatTimeParts(diff) {
				const absDiff = Math.max(0, Math.abs(diff));

				const days = Math.floor(absDiff / (1000 * 60 * 60 * 24));
				const hours = Math.floor((absDiff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
				const minutes = Math.floor((absDiff % (1000 * 60 * 60)) / (1000 * 60));
				const seconds = Math.floor((absDiff % (1000 * 60)) / 1000);


				if (days > 0) {
					return `${days}d ${hours}h`;
				} else if (hours > 0) {
					return `${hours}h ${minutes}m`;
				} else if (minutes > 0) {
					return `${minutes}m ${seconds}s`;
				} else {
					return `${seconds}s`;
				}
			}

			function updateTimestamp(element) {
				const startDate = new Date(element.dataset.start).getTime();
				const endDate = new Date(element.dataset.end).getTime();
				const now = Date.now();

				const diffToStart = startDate - now;
				const diffToEnd = endDate - now;

				if (diffToStart > 1000) {
					element.textContent = `Starts in ${formatTimeParts(diffToStart)}`;
				} else if (diffToStart >= 0) {
					element.textContent = `Starts in 0s`;
				} else if (diffToEnd > 1000) {
					element.textContent = `Ongoing (${formatTimeParts(diffToEnd)} left)`;
						if (!refreshScheduled) {
							refreshScheduled = true;
							setTimeout(() => {
								window.location.reload();
							}, 2000);
						}
				} else if (diffToEnd >= 0) {
					element.textContent = `Ending in 0s`;
				} else {
					element.textContent = `Ended ${formatTimeParts(diffToEnd)} ago`;
				}
			}

			function initTimestamps() {
				const timestamps = document.querySelectorAll('.countdown-timestamp');

				if (!timestamps.length) return;

				const tick = () => {
					timestamps.forEach(updateTimestamp);
				};

				tick();
				setInterval(tick, 1000);
			}

			if (document.readyState === 'loading') {
				document.addEventListener('DOMContentLoaded', initTimestamps);
			} else {
				initTimestamps();
			}

			document.addEventListener('astro:page-load', initTimestamps);
		})();
		</script>

	</div>
</TwoColumnLayout>
