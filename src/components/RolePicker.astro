---
interface Props {
  groupsList: string[];
}
import ToggleInput from '@components/ToggleInput.astro';
const { groupsList } = Astro.props as Props;
---

<button
  type="button"
  popovertarget="accessControl"
  class="inline-flex border-2 border-primary bg-tertiary rounded-lg py-2 px-3 text-secondary text-left"
>
  Select Role
</button>

<div 
  popover 
  id="accessControl" 
  class="bg-secondary border-2 border-primary  left-1/2 top-1/3 -translate-x-1/2 -translate-y-1/2 m-0 p-4 rounded-lg text-primary "
>
    <div class="text-lg flex flex-row gap-2">
        <input 
          type="text" 
          data-group-search 
          class="flex-1 p-2 focus:outline-none placeholder:font-bold bg-transparent" 
          placeholder="Search Groups..."
        >
        <div>
            <button class="px-4 py-1 border-2 border-primary rounded-lg active-overlay">New Group</button>
            <button 
              popovertarget="accessControl" 
              popovertargetaction="hide" 
              class="button-success px-4 py-1 border-2 rounded-lg active-overlay"
            >
              Done
            </button>
        </div>
    </div>
    
    <div class="border-b-2 border-primary w-full mt-2"></div>
    
    <div class="overflow-x-auto"> <table class="table-auto w-full border-collapse min-w-max mt-2">
            <thead>
                <tr class="border-2 border-primary bg-tertiary">
                    <th class="px-4 py-2 text-left font-semibold">Sno</th>
                    <th class="px-4 py-2 text-left font-semibold">Group Name</th>
                    <th class="px-4 py-2 text-left font-semibold">Group Description</th>
                    <th class="px-4 py-2 text-left font-semibold">Full</th>
                    <th class="px-4 py-2 text-left font-semibold">View</th>
                    <th class="px-4 py-2 text-left font-semibold">Create</th>
                    <th class="px-4 py-2 text-left font-semibold">Delete</th>
                    <th class="px-4 py-2 text-left font-semibold">Restore</th>
                    <th class="px-4 py-2 text-left font-semibold">Export</th>
                </tr>
            </thead>
            <tbody>
                {groupsList.map((group, index) => (
                    <tr 
                      class="border-2 border-primary hover:bg-black/5" 
                      data-group-row 
                      data-group-name={group.toLowerCase()}
                    >
                        <td class="px-4 py-2">{index + 1}</td>
                        <td class="px-4 py-2 font-bold">{group}</td>
                        <td class="px-4 py-2">{group} Description</td>
                        <td class="px-4 py-2"><ToggleInput name='full' /></td>
                        <td class="px-4 py-2"><ToggleInput name='view' /></td>
                        <td class="px-4 py-2"><ToggleInput name='create' /></td>
                        <td class="px-4 py-2"><ToggleInput name='delete' /></td>
                        <td class="px-4 py-2"><ToggleInput name='restore' /></td>
                        <td class="px-4 py-2"><ToggleInput name='export' /></td>
                    </tr>
                ))}
            </tbody>
        </table>
    </div>
</div>

<script>
  const initSearch = () => {
    const searchInput = document.querySelector('[data-group-search]') as HTMLInputElement;
    const rows = document.querySelectorAll('[data-group-row]') as NodeListOf<HTMLElement>;

    if (searchInput) {
      searchInput.addEventListener('input', (e) => {
        const target = e.target as HTMLInputElement;
        const value = target.value.toLowerCase();
        
        rows.forEach(row => {
          const name = row.dataset.groupName || '';
          row.style.display = name.includes(value) ? '' : 'none';
        });
      });
    }
  };

  initSearch();
</script>
