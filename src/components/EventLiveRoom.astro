---
import TwoColumnLayout from "@layouts/TwoColumnLayout.astro"
import Timestamp from "@components/Timestamp.astro"
const { Id, Title, Description, StartAt, EndAt} = Astro.props

---
<TwoColumnLayout title="event">

	<div slot="max-slot" class="h-full">
		<div class="border-2 border-primary bg-secondary h-full rounded-xl p-4  flex flex-col items-center overflow-y-auto">
			<h1 class="text-xl font-bold items-center">All Quie</h1>
			<div class=" border-b-2 border-primary w-full mt-2"></div>

				<form method="post" class="flex flex-col w-full mt-2 px-4 h-full lg:overflow-y-auto">

				<div class="flex-1">
					g
				</div>

				<div>
					p
				</div>




				</form>

		</div>
	</div>


	<div slot="min-slot" class="h-full">
		<div class="border-2 border-primary bg-secondary h-full rounded-xl p-4 flex flex-col items-center">
			<h1 class="text-xl font-bold items-center">Quiz Tracker</h1>
			<div class="border-b-2 border-primary w-full mt-2"></div>

			<div class="flex flex-col w-full h-full pt-2 px-4">


				<!-- check -->





				<!-- check -->


				<div class="w-full flex flex-row justify-between">
					<h3 class="text-lg font-semibold mt-2">Time Remaining</h3>

					<!-- <span id="countdown-timestamp" class="mt-2 text-lg text-secondary">5 Mins 12 sec </span> -->
					<div class="mt-2 text-lg text-secondary">
						<Timestamp startTime={StartAt} endTime={EndAt} eventName="Event"/>
					</div>

				</div>



				<div class="relative mt-2 h-5 w-full rounded-xl border-2 border-primary overflow-visible group">
					<div
						class="absolute hidden -top-11 left-0
									 rounded bg-tertiary px-2 py-1 text-primary border-2 border-primary text-base whitespace-nowrap pointer-events-none z-50
									 after:content-[''] after:absolute after:top-full after:left-1/2 after:-translate-x-1/2
									 after:border-7 after:border-transparent after:border-t-(--color-border-primary)"
						id="tooltip">
					</div>

					<!-- Time progress (bottom layer) -->
					<progress
						class="absolute inset-0 w-full h-full progress-time rounded-xl"
						value="70"
						max="100"
						data-text="Time Remaining">
					</progress>
					<!-- Questions progress (top layer) -->
					<progress
						class="absolute inset-0 w-full h-full progress-questions rounded-xl"
						value="40"
						max="100"
						data-text="Questions Attempted">
					</progress>

				</div>


				<div>

					<h3 class="text-lg font-semibold mt-2">Questions</h3>

					<div class="border-2 border-primary rounded-lg p-4 mt-2  grid grid-cols-[repeat(auto-fill,minmax(2.5rem,1fr))]    gap-2">

					<div class="shrink-0 text-primary text-lg bg-accent flex justify-center items-center rounded-lg w-10 h-10 border border-primary hover:scale-[110%]">
						11
					</div>


					<div class="shrink-0 text-primary text-lg bg-tertiary flex justify-center items-center rounded-lg w-10 h-10 border border-primary ">
							12
					</div>


					<div class="shrink-0 text-primary text-lg bg-secondary hover:hover-primary flex justify-center items-center rounded-lg w-10 h-10 border border-primary">
						13
					</div>

					<div class="shrink-0 text-primary text-lg bg-secondary flex justify-center items-center rounded-lg w-10 h-10 border border-primary">
						13
					</div>


					<div class="shrink-0 text-primary text-lg bg-secondary flex justify-center items-center rounded-lg w-10 h-10 border border-primary">
						13
					</div>


					<div class="shrink-0 text-primary text-lg bg-secondary flex justify-center items-center rounded-lg w-10 h-10 border border-primary">
						13
					</div>

					<div class="shrink-0 text-primary text-lg bg-secondary flex justify-center items-center rounded-lg w-10 h-10 border border-primary">
						13
					</div>

					<div class="shrink-0 text-primary text-lg bg-secondary flex justify-center items-center rounded-lg w-10 h-10 border border-primary">
						13
					</div>

					<div class="shrink-0 text-primary text-lg bg-secondary flex justify-center items-center rounded-lg w-10 h-10 border border-primary">
						13
					</div>


					<div class="shrink-0 text-primary text-lg bg-secondary flex justify-center items-center rounded-lg w-10 h-10 border border-primary">
						13
					</div>

					<div class="shrink-0 text-primary text-lg bg-secondary flex justify-center items-center rounded-lg w-10 h-10 border border-primary">
						13
					</div>

					</div>
				</div>


				<div class="flex-1"> </div>

				<div class="flex flex-col w-full mb-2 items-center">
					<button class="flex flex-row items-center gap-3 bg-accent text-lg rounded-lg border-2 border-primary px-8 py-2">

						<span>Finish & Submit</span>
					<svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 28 28" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
						<path d="M4.5 16.5c-1.5 1.26-2 5-2 5s3.74-.5 5-2c.71-.84.7-2.13-.09-2.91a2.18 2.18 0 0 0-2.91-.09z"/>
						<path d="m12 15-3-3a22 22 0 0 1 2-3.95A12.88 12.88 0 0 1 22 2c0 2.72-.78 7.5-6 11a22.35 22.35 0 0 1-4 2z"/>
						<path d="M9 12H4s.55-3.03 2-4c1.62-1.08 5 0 5 0"/>
						<path d="M12 15v5s3.03-.55 4-2c1.08-1.62 0-5 0-5"/>
					</svg>
					</button>


				</div>

		<script is:inline>
		(function () {
			let refreshScheduled = false;
			function formatTimeParts(diff) {
				const absDiff = Math.max(0, Math.abs(diff));

				const days = Math.floor(absDiff / (1000 * 60 * 60 * 24));
				const hours = Math.floor((absDiff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
				const minutes = Math.floor((absDiff % (1000 * 60 * 60)) / (1000 * 60));
				const seconds = Math.floor((absDiff % (1000 * 60)) / 1000);


				if (days > 0) {
					return `${days}d ${hours}h`;
				} else if (hours > 0) {
					return `${hours}h ${minutes}m`;
				} else if (minutes > 0) {
					return `${minutes}m ${seconds}s`;
				} else {
					return `${seconds}s`;
				}
			}

			function updateTimestamp(element) {
				const startDate = new Date(element.dataset.start).getTime();
				const endDate = new Date(element.dataset.end).getTime();
				const now = Date.now();

				const diffToStart = startDate - now;
				const diffToEnd = endDate - now;

				if (diffToStart > 1000) {
					element.textContent = `Starts in ${formatTimeParts(diffToStart)}`;
				} else if (diffToStart >= 0) {
					element.textContent = `Starts in 0s`;
				} else if (diffToEnd > 1000) {
					element.textContent = `Ongoing (${formatTimeParts(diffToEnd)} left)`;
				} else if (diffToEnd >= 0) {
					element.textContent = `Ending in 0s`;
				} else {
					element.textContent = `Ended ${formatTimeParts(diffToEnd)} ago`;
					// if (!refreshScheduled) {
					// 	refreshScheduled = true;
					// 	setTimeout(() => {
					// 		window.location.reload();
					// 	}, 2000);
					// }
				}
			}

			function initTimestamps() {
				const timestamps = document.querySelectorAll('.countdown-timestamp');

				if (!timestamps.length) return;

				const tick = () => {
					timestamps.forEach(updateTimestamp);
				};

				tick();
				setInterval(tick, 1000);
			}

			if (document.readyState === 'loading') {
				document.addEventListener('DOMContentLoaded', initTimestamps);
			} else {
				initTimestamps();
			}

			document.addEventListener('astro:page-load', initTimestamps);
		})();
		</script>

				<script>
					const tooltip = document.getElementById('tooltip');
					const timeProgress = document.querySelector<HTMLProgressElement>('.progress-time');
					const questionsProgress = document.querySelector<HTMLProgressElement>('.progress-questions');

					if (!tooltip || !timeProgress || !questionsProgress) {
						console.error('Required elements not found');
					} else {
						function showTooltip(
							bar: HTMLProgressElement,
							tooltip: HTMLElement,
							event: MouseEvent
						) {
							const rect = bar.getBoundingClientRect();
							const parent = bar.parentElement;
							if (!parent) return;

							const containerRect = parent.getBoundingClientRect();
							const mouseX = event.clientX - rect.left;
							const barWidth = rect.width;
							const percentage = (bar.value / bar.max) * 100;
							const filledWidth = (barWidth * percentage) / 100;

							if (mouseX <= filledWidth) {
								tooltip.textContent = bar.dataset.text ?? '';
								tooltip.classList.remove('hidden');

								const relativeX = event.clientX - containerRect.left;
								tooltip.style.left = `${relativeX}px`;
								tooltip.style.transform = 'translateX(-50%)';
							} else {
								tooltip.classList.add('hidden');
							}
						}

						questionsProgress.addEventListener('mousemove', e =>
							showTooltip(questionsProgress, tooltip, e)
						);
						questionsProgress.addEventListener('mouseleave', () =>
							tooltip.classList.add('hidden')
						);

						timeProgress.addEventListener('mousemove', e =>
							showTooltip(timeProgress, tooltip, e)
						);
						timeProgress.addEventListener('mouseleave', () =>
							tooltip.classList.add('hidden')
						);
					}

				</script>




			</div>

		</div>
	</div>



</TwoColumnLayout>

