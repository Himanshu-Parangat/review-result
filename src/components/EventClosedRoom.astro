---
import BaseLayout from "@layouts/BaseLayout.astro"
import Timestamp from "@components/Timestamp.astro"

const { Id, Title, Description, StartAt, EndAt, IsSubmitted} = Astro.props

const registerId = ""

---
<BaseLayout title="Register">
	<div class="h-full mx-[5%] flex flex-col items-center">
		<h1 class="text-2xl font-bold mb-1">{ IsSubmitted ? ("Your Response is Recorded!"):("Event is Ended!") }</h1>
		<h3 class="text-secondary text-sm font-bold mb-2">
			Please Contact you Organizer for update.
		</h3>
		<div class="border-2 border-primary bg-secondary rounded-lg p-10 space-y-6 mt-[2%] min-w-[50%]">
			<div class="flex flex-col items-center">
				<div class="flex flex-row gap-4 border-2 bg-tertiary border-primary px-6 py-4 rounded-lg max-w-[70%]">
					<div class="shrink-0 text-primary text-lg bg-accent flex justify-center items-center rounded-lg w-13 h-13">
						<svg width="35" height="35" viewBox="0 0 35 35" xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor">
							<rect x="6" y="8" width="22" height="20" rx="2" stroke-width="2"/>
							<line x1="6" y1="13" x2="28" y2="13" stroke-width="2"/>
							<line x1="11" y1="8" x2="11" y2="5" stroke-width="2" stroke-linecap="round"/>
							<line x1="23" y1="8" x2="23" y2="5" stroke-width="2" stroke-linecap="round"/>
							<text x="17" y="23" text-anchor="middle" font-size="10" font-weight="bold" fill="currentColor" stroke="none">
								S
							</text>
						</svg>
					</div>
					<div class="flex flex-col text-start">
						<h1 class="text-3xl">{Title || "Event"}</h1>
						<h3 class="text-xl text-secondary">{Description || "Description"}</h3>
					</div>
				</div>
			</div>

			<div id="countdown" class="flex flex-col items-center justify-center">
				<div class="flex flex-row items-center justify-center border-2 border-primary bg-tertiary rounded-lg px-6 py-2">
					<svg xmlns="http://www.w3.org/2000/svg" width="42" height="42" viewBox="0 0 128 128" role="img" stroke="currentColor" aria-label="duration icon" class="mt-1 animate-pulse">
						<circle cx="64" cy="52" r="36" fill="none"  stroke-width="8" />
						<line x1="64" y1="52" x2="64" y2="32"  stroke-width="8" stroke-linecap="round"/>
						<line x1="64" y1="52" x2="84" y2="68"  stroke-width="6" stroke-linecap="round"/>
					</svg>
					<Timestamp startTime={StartAt} endTime={EndAt} eventName="Event"/>
				</div>
			</div>

			<form id="registrationForm" class="space-y-4">
					<div class="space-y-4 mt-8">
					<input type="hidden" name="action" value="create">
					<input type="hidden" name="eventId" value={registerId}>


					<div class="flex flex-row mt-4 justify-center">
						<svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-accent">
							<circle cx="12" cy="12" r="10"/>
							<line x1="12" y1="8" x2="12" y2="12"/>
							<line x1="12" y1="16" x2="12.01" y2="16"/>
						</svg>

							<h3 class="text-lg text-secondary ml-2">Want to register for new Event?</h3>
					</div>

					<div class="flex flex-col items-center justify-center gap-4">
						<button
							id="doEntry"
							type="submit"
							class="w-full text-xl px-6 py-3 rounded-lg bg-accent text-white font-semibold hover:opacity-90 transition"
						>
							<div class="flex flex-row justify-center items-center">
								<span class="mr-2">
									Exit Event
								</span>
								<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
									<path d="M4.5 16.5c-1.5 1.26-2 5-2 5s3.74-.5 5-2c.71-.84.7-2.13-.09-2.91a2.18 2.18 0 0 0-2.91-.09z"/>
									<path d="m12 15-3-3a22 22 0 0 1 2-3.95A12.88 12.88 0 0 1 22 2c0 2.72-.78 7.5-6 11a22.35 22.35 0 0 1-4 2z"/>
									<path d="M9 12H4s.55-3.03 2-4c1.62-1.08 5 0 5 0"/>
									<path d="M12 15v5s3.03-.55 4-2c1.08-1.62 0-5 0-5"/>
								</svg>
							</div>
						</button>


					</div>

			</form>
		</div>
	</div>


		<script is:inline>
		(function () {
			let refreshScheduled = false;
			function formatTimeParts(diff) {
				const absDiff = Math.max(0, Math.abs(diff));

				const days = Math.floor(absDiff / (1000 * 60 * 60 * 24));
				const hours = Math.floor((absDiff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
				const minutes = Math.floor((absDiff % (1000 * 60 * 60)) / (1000 * 60));
				const seconds = Math.floor((absDiff % (1000 * 60)) / 1000);


				if (days > 0) {
					return `${days}d ${hours}h`;
				} else if (hours > 0) {
					return `${hours}h ${minutes}m`;
				} else if (minutes > 0) {
					return `${minutes}m ${seconds}s`;
				} else {
					return `${seconds}s`;
				}
			}

			function updateTimestamp(element) {
				const startDate = new Date(element.dataset.start).getTime();
				const endDate = new Date(element.dataset.end).getTime();
				const now = Date.now();

				const diffToStart = startDate - now;
				const diffToEnd = endDate - now;

				if (diffToStart > 1000) {
					element.textContent = `Starts in ${formatTimeParts(diffToStart)}`;
				} else if (diffToStart >= 0) {
					element.textContent = `Starts in 0s`;
				} else if (diffToEnd > 1000) {
					element.textContent = `Ongoing (${formatTimeParts(diffToEnd)} left)`;
				} else if (diffToEnd >= 0) {
					element.textContent = `Ending in 0s`;
				} else {
					element.textContent = `Ended ${formatTimeParts(diffToEnd)} ago`;
				}
			}

			function initTimestamps() {
				const timestamps = document.querySelectorAll('.countdown-timestamp');

				if (!timestamps.length) return;

				const tick = () => {
					timestamps.forEach(updateTimestamp);
				};

				tick();
				setInterval(tick, 1000);
			}

			if (document.readyState === 'loading') {
				document.addEventListener('DOMContentLoaded', initTimestamps);
			} else {
				initTimestamps();
			}

			document.addEventListener('astro:page-load', initTimestamps);
		})();
		</script>

</BaseLayout>
